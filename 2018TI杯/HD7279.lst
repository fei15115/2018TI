C51 COMPILER V9.54   HD7279                                                                04/07/2021 23:27:20 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE HD7279
OBJECT MODULE PLACED IN HD7279.obj
COMPILER INVOKED BY: F:\keil\C51\BIN\C51.EXE 应用\HD7279.C LARGE OPTIMIZE(8,SPEED) BROWSE INCDIR(.\应用) DEBUG OBJECTEXT
                    -END PRINT(.\HD7279.lst) TABS(2) OBJECT(HD7279.obj)

line level    source

   1          //-----------------------------------------------
   2          // 版权归    SivaYao   所有
   3          // 第一次编程时间:2014年07月23日
   4          //-----------------------------------------------
   5          // 文件名：  HD7279.C
   6          // 编写人：  SivaYao 
   7          // 编写时间：2013/05/26
   8          // 目标器件: STC15F2K60S2或者IAP15F2K61S2
   9          // 编译工具: Keil uV3
  10          //-----------------------------------------------
  11          // 程序说明:
  12          // 此函数库用于STC15F2K60S2最小系统板上HD7279所驱
  13          //     动按键显示的控制程序
  14          //-----------------------------------------------
  15          
  16          #include     "HD7279.H"
  17          
  18          
  19          code u8 KeyTable[32]= {0xFF,0xFF,0xFF,0x07,0x04,0x01,0xF6,0xFF,
  20                                 0xFF,0xFF,0xFF,0x08,0x05,0x02,0x00,0xFF,
  21                                 0xFF,0xFF,0xFF,0x09,0x06,0x03,0xF5,0xFF,
  22                                 0xFF,0xFF,0xFF,0xF1,0xF2,0xF3,0xF4,0xFF, 
  23                                 };
  24          //***********************************************
  25          //            五/硬件库程序
  26          //***********************************************
  27          /***********************************************/
  28          //5.1---HD7279(按键显示)驱动集
  29          //**5.1.1-------SEND7279B   (HD7279字节发送子程序)
  30          //**5.1.2-------RECEIVE7279B(HD7279字节接收子程序)
  31          //**5.1.3-------DELAY7279   (HD7279延时子程序)
  32          //**5.1.4-------SEND7279_CMD(HD7279发送单字节指令子程序)
  33          //**5.1.5-------SEND7279_CMD_DATA(HD7279发送带数据指令子程序)
  34          //**5.1.6-------READ7279_KEY(从HD7279读取按键键码)
  35          //**5.1.7-------READ7279_NUM(从HD7279读取按键键值)
  36          /***********************************************/
  37          //---------------------------------------------------------
  38          //名称:(5.1.1)SEND7279B  功能:向HD7279发送一个字节 
  39          //入口:DATAOUT     出口:无   全局:无   调用模块:  DELAY7279
  40          //---------------------------------------------------------
  41          void     SEND7279B (u8 DATAOUT)   //7279字节发送子程序
  42          {
  43   1         u8 i;
  44   1      
  45   1         DELAY7279  (SYSTEM_OSC/240000);//长延时
  46   1         for  ( i=0 ; i<8 ; i++)  {     //8次循环每次发送一个位      
  47   2            if     (DATAOUT & 0x80){    //选择待发送字节的最高位挂载到DAT线上
  48   3               DAT   = 1 ; }
  49   2          else {
  50   3             DAT   = 0 ; }
  51   2          CLK        = 1 ;        //CLK拉高，产生上升沿
  52   2          DELAY7279  (SYSTEM_OSC/1200000)   ; //短延时
  53   2          CLK        = 0 ;        //CLK拉低
  54   2          DELAY7279  (SYSTEM_OSC/1200000)   ; //短延时
C51 COMPILER V9.54   HD7279                                                                04/07/2021 23:27:20 PAGE 2   

  55   2          DATAOUT    = DATAOUT*2 ;}   //待发送字节左移一位     
  56   1         DAT   = 0 ;            //DAT线拉低（？？）
  57   1         }      //5.1.1结束
  58          //---------------------------------------------------------
  59          //名称:(5.1.2)RECEIVE7279    功能:从HD7279接收一个字节
  60          //入口:无     出口:DATAIN    全局:无   调用模块:  DELAY7279 
  61          //---------------------------------------------------------
  62          u8    RECEIVE7279B   (void)    //7279字节接收子程序
  63          {
  64   1         u8  i,DATAIN = 0 ;
  65   1      
  66   1         DAT            = 1 ;           //DAT线拉高（不拉高接收不了数据）
  67   1         DELAY7279 (SYSTEM_OSC/240000); //长延时
  68   1         for   (i=0;i<8;i++) {          //循环8次，接收8位数据       
  69   2            CLK        = 1     ;        //CLK拉高，产生上升沿
  70   2            DELAY7279  (SYSTEM_OSC/1200000)  ;//短延时
  71   2          DATAIN     = DATAIN*2 ;     //已接受数据移位
  72   2            if        (DAT) {           //把DAT线上数据加入数据最低位
  73   3             DATAIN  = DATAIN|0x01 ; }
  74   2          CLK        = 0 ;            //CLK拉低
  75   2          DELAY7279  (SYSTEM_OSC/1200000) ;}//短延时
  76   1         DAT            = 0 ;    //DAT线拉低（？？）
  77   1         return ( DATAIN ) ;       //返回DATAIN
  78   1         }        //5.1.2结束
  79          //---------------------------------------------------------
  80          //名称:(5.1.3)DELAY7279B   功能:HD7279延时
  81          //入口:NUM         出口:无   全局:无   调用模块:  无 
  82          //---------------------------------------------------------
  83          void     DELAY7279 (u8 num)   //7279延时子程序
  84          {
  85   1         u8  i;
  86   1          
  87   1         for (i=num;i!=0;i--) {    //循环等待延时   
  88   2          }
  89   1         }      //5.1.3结束
  90          //---------------------------------------------------------
  91          //名称:(5.1.4)SEND7279_CMD   功能:HD7279发送单字节指令子程序
  92          //入口:CMD    出口:无        全局:无   调用模块:SEND7279B 
  93          //---------------------------------------------------------
  94          void     SEND7279_CMD   (u8 CMD) 
  95          {   
  96   1         CS7279         = 0 ;      //选通HD7279芯片
  97   1         SEND7279B      (CMD);     //发送CMD指令至HD7279
  98   1         CS7279         = 1 ;      //释放HD7279
  99   1         }      //5.1.4结束
 100          //---------------------------------------------------------
 101          //名称:(5.1.5)SEND7279_CMD_DATA 功能:发送带数据指令子程序
 102          //入口:CMD,DATA  出口:无     全局:无   调用模块:SEND7279B
 103          //---------------------------------------------------------
 104          void     SEND7279_CMD_DATA(u8 CMD,u8 DATA) 
 105          {  
 106   1         CS7279         = 0 ;      //选通HD7279芯片
 107   1         SEND7279B      (CMD);     //发送CMD指令至HD7279
 108   1         SEND7279B      (DATA);    //发送数据至HD7279
 109   1         CS7279         = 1 ;      //释放HD7279
 110   1         }      //5.1.5结束
 111          //---------------------------------------------------------
 112          //名称:(5.1.6)READ7279_KEY   功能:HD7279读取按键键码子程序
 113          //入口:无  出口:KEYNUM  全局:无   调用模块:SEND7279B,RECEIVE7279B  
 114          //---------------------------------------------------------
 115          u8       READ7279_KEY   (void)     //从HD7279读取按键键码
 116          {
C51 COMPILER V9.54   HD7279                                                                04/07/2021 23:27:20 PAGE 3   

 117   1         u8     KEYNUM ;
 118   1      
 119   1         CS7279         = 0 ;      //选通HD7279芯片
 120   1         SEND7279B      (0x15);    //发送读键码指令至HD7279
 121   1         KEYNUM      =RECEIVE7279B();//接收键码
 122   1         CS7279         = 1 ;      //释放HD7279
 123   1         return (KEYNUM);        //返回键码KEYNUM
 124   1         }      //5.1.6结束
 125          //---------------------------------------------------------
 126          //名称:(5.1.7)READ7279_NUM   功能:HD7279读取按键键值子程序
 127          //入口:无  出口:NUM     全局:无   调用模块:SEND7279B,RECEIVE7279B  
 128          //---------------------------------------------------------
 129          u8       READ7279_NUM   (void)     //从HD7279读取按键键值
 130          {
 131   1        return ( KeyTable[READ7279_KEY()] );     //返回键值
 132   1        }
 133          /*HD7279子程序*****************************/
 134          /***********************************************/


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    186    ----
   CONSTANT SIZE    =     32    ----
   XDATA SIZE       =   ----       5
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
